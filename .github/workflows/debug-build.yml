name: Debug Build Issues

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: macos-latest
    
    steps:
    - name: ðŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    
    - name: ðŸŽ è®¾ç½® Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
    
    - name: ðŸ” æ˜¾ç¤ºçŽ¯å¢ƒä¿¡æ¯
      run: |
        echo "ðŸ–¥ï¸  macOS ç‰ˆæœ¬: $(sw_vers -productVersion)"
        echo "ðŸ”¨ Xcode ç‰ˆæœ¬: $(xcodebuild -version)"
        echo "ðŸ’» æž¶æž„: $(uname -m)"
        swift --version
    
    - name: ðŸ“‹ æ£€æŸ¥é¡¹ç›®é…ç½®
      run: |
        echo "ðŸ” æ£€æŸ¥é¡¹ç›®æ–‡ä»¶..."
        ls -la DockLambda.xcodeproj/
        
        echo "ðŸŽ¯ æ£€æŸ¥ Scheme..."
        xcodebuild -list -project DockLambda.xcodeproj
        
        echo "ðŸ—‚ï¸ æ£€æŸ¥æºæ–‡ä»¶..."
        ls -la DockLambda/
    
    - name: ðŸ§ª è¯­æ³•æ£€æŸ¥ - å•ä¸ªæ–‡ä»¶ç¼–è¯‘
      run: |
        echo "ðŸ” é€ä¸ªæ£€æŸ¥ Swift æ–‡ä»¶è¯­æ³•..."
        
        cd DockLambda
        
        # æ£€æŸ¥æ¯ä¸ª Swift æ–‡ä»¶çš„è¯­æ³•
        for file in *.swift; do
          echo "æ£€æŸ¥: $file"
          if ! swift -frontend -parse -primary-file "$file" -sdk $(xcrun --show-sdk-path --sdk macosx) >/dev/null 2>&1; then
            echo "âŒ è¯­æ³•é”™è¯¯åœ¨æ–‡ä»¶: $file"
            swift -frontend -parse -primary-file "$file" -sdk $(xcrun --show-sdk-path --sdk macosx)
            exit 1
          else
            echo "âœ… $file è¯­æ³•æ­£ç¡®"
          fi
        done
    
    - name: ðŸ”¨ è¯¦ç»†æž„å»ºæµ‹è¯•
      run: |
        echo "ðŸš€ è¯¦ç»†æž„å»ºä¿¡æ¯..."
        
        xcodebuild \
          -scheme DockLambda \
          -configuration Debug \
          -destination "generic/platform=macOS" \
          build \
          -verbose \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO \
          DEVELOPMENT_TEAM="" \
          PRODUCT_BUNDLE_IDENTIFIER="com.example.DockLambda" \
        || true
        
        echo "ðŸ“‹ æŸ¥çœ‹æž„å»ºæ—¥å¿—..."
    
    - name: ðŸ” æ£€æŸ¥ä¾èµ–å’Œå¯¼å…¥
      run: |
        echo "ðŸ” æ£€æŸ¥ Swift å¯¼å…¥..."
        
        # æ£€æŸ¥æ˜¯å¦èƒ½æ­£ç¡®å¯¼å…¥ç³»ç»Ÿæ¡†æž¶
        cat > test_imports.swift << 'EOF'
        import Cocoa
        import ServiceManagement
        import SpriteKit
        
        print("å¯¼å…¥æµ‹è¯•é€šè¿‡")
        EOF
        
        swift test_imports.swift
        
        echo "âœ… ç³»ç»Ÿæ¡†æž¶å¯¼å…¥æ­£å¸¸"